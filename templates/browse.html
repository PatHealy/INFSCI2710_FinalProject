{% extends "layout.html" %}
{% block head %}
<script type="text/javascript">
	var type = "{{ table }}";
	var table = type;
	var order = "{{ order }}";
	var order_by = "{{ order_by }}";
	var keys = [{% if not keys == None %} {% for x in keys %} '{{x}}', {% endfor %} {% endif %}];

	function browse_category(cat){
		window.location = "/browse/" + cat;
	}

	function reorder(element, order){
		window.location = '/browse/' + table + "/" + element + "/" + order;
	}

	function edit(pk){
		window.location = '/edit/' + table + "/" + pk;
	}

	function remove(item){
		var toSend = {};
		for(var i = 0; i < item.length; i++){
			toSend[keys[i]] = item[i];
		}
		
		toSend['table'] = "{{table}}";

		console.log(toSend);
		
		var xhr = new XMLHttpRequest();
		var url = "/remove";
		xhr.open("POST", url, true);
		xhr.setRequestHeader("Content-type", "application/json");
		xhr.onreadystatechange = function () { 
		if (xhr.readyState == 4 && xhr.status == 200) {
				window.location = "/update/{{table}}/remove";
			}
		}
		var data = JSON.stringify(toSend);
		xhr.send(data);
	}

	function create(){
		window.location = '/create/' + table;
	}

	function search_by(k){
		window.location = '/browse-search/' + table + "/" + k + "/" + document.getElementById("search_term").value;
	}

</script>
{% endblock %}
{% block body %}
<!-- 
This is essentially the home page of browsing. It links to other pages that handle specific kinds of browsing.

Handles the Employee Browsing operations

â€¢	Employee Browsing Employees must be able to search the database for particular items based on various attributes and must also be able to do browsing (i.e., less focused searching). Examples:
o	Search for cases by status and timeframe
o	Search for a customer and view products the customer has purchased
o	Search for common resolutions by product
 -->
<div class="card">
	<h2 class ="card-header">Browse</h2>
	<div class="card-body">
		<h4>This page handles browsing all entities in the database.</h4>
		<button id="browse_customers_button" type="button" class="btn btn-primary" onclick="browse_category('customers')">Browse Customers</button>
		<button id="browse_products_button" type="button" class="btn btn-primary" onclick="browse_category('products')">Browse Products</button>
		<button id="browse_salespersons_button" type="button" class="btn btn-primary" onclick="browse_category('salespersons')">Browse Salespersons</button>
		<button id="browse_employees_button" type="button" class="btn btn-primary" onclick="browse_category('employees')">Browse Employees</button>
		<button id="browse_cases_button" type="button" class="btn btn-primary" onclick="browse_category('cases')">Browse Cases</button>
		<button id="browse_resolutions_button" type="button" class="btn btn-primary" onclick="browse_category('resolutions')">Browse Resolutions</button>
		<button id="browse_orders_button" type="button" class="btn btn-primary" onclick="browse_category('orders')">Browse Orders</button>
		<button id="browse_comments_button" type="button" class="btn btn-primary" onclick="browse_category('comments')">Browse Comments</button>
		<br/><br/>
		<!-- Start search bars -->
		{% if keys != None %}
			<div class="row">
				<div class="col">
					<div class="form-group">
						<input type="text" class="form-control" id="search_term" placeholder="Search...">
						<small class="form-text text-muted">Give a search term and we'll search for that term in the column you specify.</small>
					</div>
				</div>
				<div class="col">
					<div class="dropdown">
						<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Search by...
						<span class="caret"></span></button>
						<ul class="dropdown-menu">
							{% for k in string_items %}
							<li><a href="javascript:search_by('{{k}}')">{{k}}</a></li>
							{% endfor %}
						</ul>
					</div>
				</div>
			</div>
		{% endif %}
		<!-- Start Table -->
		{% if keys != None %}
		<table class="table">
			<thead class="thead-light">
				<tr>
					{% for key in keys %}
						<th scope="col">{{ key }} 
							{% if key != order_by %}
								<button type="button" class="btn btn-link" onclick="reorder('{{key}}', 'DESC')" style="font-size:200%;">-</button>
							{% elif order == 'DESC' %}
								<button type="button" class="btn btn-link" onclick="reorder('{{key}}', 'ASC')" style="font-size:200%;">v</button>
							{% else %}
								<button type="button" class="btn btn-link" onclick="browse_category('{{table}}')" style="font-size:200%;">^</button>
							{% endif %}
						</th>
					{% endfor %}
				</tr>
			</thead>
			<tbody>
			{% for item in contents %}
				<tr>
					{% for v in item %}
					<td>{{ v }}</td>
					{% endfor %}
					<td><button type="button" class="btn btn-warning" onclick="edit({{ item[0] }})">edit...</button></td>
					<td><button type="button" class="btn btn-danger" onclick="remove([{% for v in range(num_types) %} {% if types[v] or item[v] == None %} '{{item[v]}}', {% else %} {{item[v]}}, {% endif %}{% endfor %}])">DELETE</button></td>
				</tr>
			{% else %}
				There are no contents...
			{% endfor %}
			</tbody>
		</table>
		<button type="button" class="btn btn-success" onclick="create()">Add a new entry in {{table}}</button>
		{% else %}
			<h2>Choose a category to continue.</h2>
		{% endif %}
	</div>
</div>
<br/>
<br/>


<script type="text/javascript">
	if (type == "customers"){
		$("#browse_customers_button").removeClass("btn-primary");
		$("#browse_customers_button").addClass("btn-secondary");
	} else if (type == "products"){
		$("#browse_products_button").removeClass("btn-primary");
		$("#browse_products_button").addClass("btn-secondary");
	} else if (type == "salespersons"){
		$("#browse_salespersons_button").removeClass("btn-primary");
		$("#browse_salespersons_button").addClass("btn-secondary");
	} else if (type == "employees"){
		$("#browse_employees_button").removeClass("btn-primary");
		$("#browse_employees_button").addClass("btn-secondary");
	} else if (type == "cases"){
		$("#browse_cases_button").removeClass("btn-primary");
		$("#browse_cases_button").addClass("btn-secondary");
	} else if (type == "resolutions"){
		$("#browse_resolutions_button").removeClass("btn-primary");
		$("#browse_resolutions_button").addClass("btn-secondary");
	} else if (type == "orders"){
		$("#browse_orders_button").removeClass("btn-primary");
		$("#browse_orders_button").addClass("btn-secondary");
	} else if (type == "comments"){
		$("#browse_comments_button").removeClass("btn-primary");
		$("#browse_comments_button").addClass("btn-secondary");
	}
</script>

{% endblock %}